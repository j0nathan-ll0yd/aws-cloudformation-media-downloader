## YouTube Cookie Expiration

YouTube has detected the cookies as expired or is blocking requests with bot detection.

**Triggered By**:
- **File ID**: ${fileId}
- **Video URL**: ${fileUrl}
- **Error Message**: ${errorMessage}
- **Timestamp**: ${timestamp}

---

## Required Action: Check Automated Cookie Refresh

### Step 1: Check GitHub Actions
The cookie refresh workflow runs automatically every 2 days. Check if there's a pending PR:
- [View pending PRs](https://github.com/j0nathan-ll0yd/aws-cloudformation-media-downloader/pulls?q=is%3Apr+is%3Aopen+refresh+cookies)
- [View workflow runs](https://github.com/j0nathan-ll0yd/aws-cloudformation-media-downloader/actions/workflows/refresh-youtube-cookies.yml)

### Step 2: If No Pending PR, Manually Trigger Workflow
```bash
gh workflow run refresh-youtube-cookies.yml
```

### Step 3: Or Extract Cookies Locally
```bash
# Ensure you're logged into YouTube in Firefox
pnpm run update-cookies
```

This will:
1. Extract cookies from Firefox browser
2. Filter to YouTube/Google domains only
3. Copy filtered cookies to Lambda layer directory

### Step 4: Build and Deploy
```bash
pnpm run build
pnpm run deploy
```

---

## Architecture Note

This project uses **Cookies + PO Tokens** for YouTube authentication:
- **Cookies**: Required for authenticated access (auto-refreshed every 2 days)
- **PO Tokens**: Generated by bgutil plugin to bypass bot detection

**OAuth2 is not available** - YouTube has blocked OAuth2 authentication with yt-dlp.

---

## Background

YouTube cookies now expire every 3-5 days (previously 30-60 days). This error indicates:
- Cookies have expired naturally
- YouTube has invalidated the session
- Bot detection triggered (datacenter IP + stale cookies)

**Cookie Location**: `layers/yt-dlp/cookies/youtube-cookies.txt`

---

## Stack Trace

```
${errorStack}
```

---

## Deduplication

**Fingerprint**: `${fingerprint}`
**Components**: ${fingerprintSummary}

> This issue will be **auto-closed** when YouTube authentication succeeds.
> The fingerprint prevents duplicate issues - if this error recurs,
> a comment will be added to this issue instead of creating a new one.

---

This issue was automatically created by the cookie monitoring system.
