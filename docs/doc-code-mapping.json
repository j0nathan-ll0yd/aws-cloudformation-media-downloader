{
  "$schema": "./doc-code-mapping.schema.json",
  "version": "1.0.0",
  "description": "Maps documentation claims to filesystem paths for validation. Used by bin/validate-doc-sync.sh",

  "entityValidation": {
    "documentedIn": "AGENTS.md",
    "sourceDirectory": "src/entities/queries",
    "pattern": "*.ts",
    "excludePatterns": ["*.test.ts", "index.ts"],
    "assertion": "count-match",
    "description": "Entity query count in AGENTS.md project structure must match src/entities/queries/*.ts files"
  },

  "lambdaValidation": {
    "documentedIn": "AGENTS.md",
    "sourceDirectory": "src/lambdas",
    "tableSection": "### Lambda Trigger Patterns",
    "assertion": "count-match",
    "description": "Lambda count in trigger table must match src/lambdas/* directories"
  },

  "mcpRuleValidation": {
    "documentedIn": ["src/mcp/validation/index.ts", "docs/wiki/MCP/Convention-Tools.md"],
    "sourceDirectory": "src/mcp/validation/rules",
    "pattern": "*.ts",
    "excludePatterns": ["*.test.ts", "index.ts", "types.ts"],
    "assertion": "count-match",
    "description": "MCP validation rule files must match registered rules in index.ts"
  },

  "pathValidations": [
    {
      "documentedPath": "src/lib/vendor/AWS/",
      "mustExist": true,
      "documentedIn": ["AGENTS.md", "docs/wiki/Conventions/Vendor-Encapsulation-Policy.md"]
    },
    {
      "documentedPath": "src/lib/vendor/BetterAuth/",
      "mustExist": true,
      "documentedIn": ["AGENTS.md"]
    },
    {
      "documentedPath": "src/mcp/",
      "mustExist": true,
      "documentedIn": ["AGENTS.md"]
    },
    {
      "documentedPath": "src/mcp/validation/",
      "mustExist": true,
      "documentedIn": ["AGENTS.md", "docs/wiki/MCP/Convention-Tools.md"]
    },
    {
      "documentedPath": "test/helpers/",
      "mustExist": true,
      "documentedIn": ["AGENTS.md", "docs/wiki/Testing/Vitest-Mocking-Strategy.md"]
    },
    {
      "documentedPath": "graphrag/",
      "mustExist": true,
      "documentedIn": ["AGENTS.md"]
    }
  ],

  "contentValidations": [
    {
      "file": "AGENTS.md",
      "mustContain": "dprint",
      "mustNotContain": "Prettier",
      "description": "AGENTS.md must reference dprint (not Prettier)"
    },
    {
      "file": "AGENTS.md",
      "mustContain": "src/lib/vendor/",
      "description": "AGENTS.md must use correct vendor path with src/ prefix"
    }
  ],

  "relationshipValidations": [
    {
      "source": "graphrag/metadata.json",
      "target": "src/entities/queries",
      "assertion": "entities-documented",
      "description": "All entities in src/entities/queries must appear in graphrag metadata entityRelationships"
    }
  ],

  "wikiLinkValidation": {
    "directory": "docs/wiki",
    "pattern": "**/*.md",
    "assertion": "links-resolve",
    "blocking": true,
    "description": "All relative markdown links in wiki must resolve to existing files"
  },

  "codePathValidation": {
    "directory": "docs/wiki",
    "pattern": "**/*.md",
    "pathPrefixes": ["src/", "test/", "util/", "types/", "build/", "graphrag/", "terraform/", "bin/", "scripts/"],
    "assertion": "paths-exist",
    "blocking": false,
    "description": "Backtick-wrapped code paths in wiki docs must exist in filesystem"
  },

  "orphanPageValidation": {
    "rootPages": ["docs/wiki/Home.md", "docs/wiki/Getting-Started.md"],
    "directory": "docs/wiki",
    "pattern": "**/*.md",
    "assertion": "reachable-from-root",
    "blocking": false,
    "description": "All wiki pages should be reachable from Home.md"
  },

  "autoFixSuggestions": {
    "entityCountMismatch": {
      "command": "find src/entities/queries -name '*.ts' ! -name '*.test.ts' ! -name 'index.ts' -exec basename {} \\;",
      "action": "Update AGENTS.md project structure to include all entity query files",
      "severity": "HIGH"
    },
    "lambdaCountMismatch": {
      "command": "find src/lambdas -mindepth 1 -maxdepth 1 -type d -exec basename {} \\;",
      "action": "Update AGENTS.md Lambda Trigger Patterns table",
      "severity": "HIGH"
    },
    "graphragMissing": {
      "command": "pnpm run graphrag:extract",
      "action": "Regenerate GraphRAG knowledge graph",
      "severity": "MEDIUM"
    },
    "stalePattern": {
      "patterns": {
        "Prettier": "dprint",
        "lib/vendor/AWS": "src/lib/vendor/AWS"
      },
      "action": "Replace outdated references in documentation",
      "severity": "HIGH"
    }
  }
}
