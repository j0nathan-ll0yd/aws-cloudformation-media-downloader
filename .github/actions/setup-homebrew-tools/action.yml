name: 'Setup Homebrew Tools'
description: 'Install Homebrew and hcl2json with caching'

runs:
  using: 'composite'
  steps:
    - name: Set up Homebrew
      uses: Homebrew/actions/setup-homebrew@master

    - name: Cache Homebrew packages
      uses: actions/cache@v4
      with:
        path: |
          ~/Library/Caches/Homebrew
          /home/linuxbrew/.linuxbrew/Cellar
        key: homebrew-hcl2json-${{ runner.os }}

    - name: Install hcl2json
      shell: bash
      run: |
        brew install hcl2json
        # Force link in case it's already installed but not linked
        brew link hcl2json --overwrite --force || true
        # Ensure Homebrew bin is in PATH for subsequent steps
        BREW_PREFIX="$(brew --prefix)"
        echo "${BREW_PREFIX}/bin" >> "$GITHUB_PATH"
        # Verify hcl2json is accessible
        "${BREW_PREFIX}/bin/hcl2json" --version || echo "hcl2json installed at ${BREW_PREFIX}/bin/hcl2json"
