{
  "nodes": [
    {
      "id": "lambda:ApiGatewayAuthorizer",
      "type": "Lambda",
      "properties": {
        "name": "ApiGatewayAuthorizer",
        "trigger": "API Gateway",
        "purpose": "Authorize API requests via Better Auth sessions"
      }
    },
    {
      "id": "lambda:CloudfrontMiddleware",
      "type": "Lambda",
      "properties": {
        "name": "CloudfrontMiddleware",
        "trigger": "CloudFront",
        "purpose": "Edge processing for CDN requests"
      }
    },
    {
      "id": "lambda:ListFiles",
      "type": "Lambda",
      "properties": {
        "name": "ListFiles",
        "trigger": "API Gateway",
        "purpose": "List files available to authenticated user"
      }
    },
    {
      "id": "lambda:LogClientEvent",
      "type": "Lambda",
      "properties": {
        "name": "LogClientEvent",
        "trigger": "API Gateway",
        "purpose": "Log client-side events for analytics"
      }
    },
    {
      "id": "lambda:LoginUser",
      "type": "Lambda",
      "properties": {
        "name": "LoginUser",
        "trigger": "API Gateway",
        "purpose": "Authenticate user via Sign In With Apple"
      }
    },
    {
      "id": "lambda:PruneDevices",
      "type": "Lambda",
      "properties": {
        "name": "PruneDevices",
        "trigger": "CloudWatch Events",
        "purpose": "Scheduled cleanup of inactive devices"
      }
    },
    {
      "id": "lambda:RefreshToken",
      "type": "Lambda",
      "properties": {
        "name": "RefreshToken",
        "trigger": "API Gateway",
        "purpose": "Refresh authentication token"
      }
    },
    {
      "id": "lambda:RegisterDevice",
      "type": "Lambda",
      "properties": {
        "name": "RegisterDevice",
        "trigger": "API Gateway",
        "purpose": "Register iOS device for push notifications"
      }
    },
    {
      "id": "lambda:RegisterUser",
      "type": "Lambda",
      "properties": {
        "name": "RegisterUser",
        "trigger": "API Gateway",
        "purpose": "Register new user via Sign In With Apple"
      }
    },
    {
      "id": "lambda:S3ObjectCreated",
      "type": "Lambda",
      "properties": {
        "name": "S3ObjectCreated",
        "trigger": "S3 Event",
        "purpose": "Handle uploaded files and notify users"
      }
    },
    {
      "id": "lambda:SendPushNotification",
      "type": "Lambda",
      "properties": {
        "name": "SendPushNotification",
        "trigger": "SQS",
        "purpose": "Send push notification to user devices via APNS"
      }
    },
    {
      "id": "lambda:StartFileUpload",
      "type": "Lambda",
      "properties": {
        "name": "StartFileUpload",
        "trigger": "SQS",
        "purpose": "Download video from YouTube to S3 (event-driven via DownloadQueue)"
      }
    },
    {
      "id": "lambda:UserDelete",
      "type": "Lambda",
      "properties": {
        "name": "UserDelete",
        "trigger": "API Gateway",
        "purpose": "Delete user and cascade to related records"
      }
    },
    {
      "id": "lambda:UserSubscribe",
      "type": "Lambda",
      "properties": {
        "name": "UserSubscribe",
        "trigger": "API Gateway",
        "purpose": "Manage user topic subscriptions"
      }
    },
    {
      "id": "lambda:WebhookFeedly",
      "type": "Lambda",
      "properties": {
        "name": "WebhookFeedly",
        "trigger": "API Gateway",
        "purpose": "Process Feedly webhooks, publish DownloadRequested events to EventBridge"
      }
    },
    {
      "id": "entity:Accounts",
      "type": "Entity",
      "properties": {
        "name": "Accounts"
      }
    },
    {
      "id": "entity:Devices",
      "type": "Entity",
      "properties": {
        "name": "Devices"
      }
    },
    {
      "id": "entity:FileDownloads",
      "type": "Entity",
      "properties": {
        "name": "FileDownloads"
      }
    },
    {
      "id": "entity:Files",
      "type": "Entity",
      "properties": {
        "name": "Files"
      }
    },
    {
      "id": "entity:Sessions",
      "type": "Entity",
      "properties": {
        "name": "Sessions"
      }
    },
    {
      "id": "entity:UserDevices",
      "type": "Entity",
      "properties": {
        "name": "UserDevices"
      }
    },
    {
      "id": "entity:UserFiles",
      "type": "Entity",
      "properties": {
        "name": "UserFiles"
      }
    },
    {
      "id": "entity:Users",
      "type": "Entity",
      "properties": {
        "name": "Users"
      }
    },
    {
      "id": "entity:VerificationTokens",
      "type": "Entity",
      "properties": {
        "name": "VerificationTokens"
      }
    },
    {
      "id": "service:DynamoDB",
      "type": "Service",
      "properties": {
        "name": "DynamoDB",
        "type": "database"
      }
    },
    {
      "id": "service:S3",
      "type": "Service",
      "properties": {
        "name": "S3",
        "type": "storage"
      }
    },
    {
      "id": "service:SNS",
      "type": "Service",
      "properties": {
        "name": "SNS",
        "type": "notification"
      }
    },
    {
      "id": "service:SQS",
      "type": "Service",
      "properties": {
        "name": "SQS",
        "type": "queue"
      }
    },
    {
      "id": "service:Lambda",
      "type": "Service",
      "properties": {
        "name": "Lambda",
        "type": "compute"
      }
    },
    {
      "id": "service:CloudWatch",
      "type": "Service",
      "properties": {
        "name": "CloudWatch",
        "type": "monitoring"
      }
    },
    {
      "id": "service:SecretsManager",
      "type": "Service",
      "properties": {
        "name": "SecretsManager",
        "type": "secrets"
      }
    },
    {
      "id": "service:StepFunctions",
      "type": "Service",
      "properties": {
        "name": "StepFunctions",
        "type": "orchestration"
      }
    },
    {
      "id": "service:XRay",
      "type": "Service",
      "properties": {
        "name": "XRay",
        "type": "tracing"
      }
    },
    {
      "id": "service:EventBridge",
      "type": "Service",
      "properties": {
        "name": "EventBridge",
        "type": "events"
      }
    },
    {
      "id": "service:API Gateway",
      "type": "Service",
      "properties": {
        "name": "API Gateway",
        "type": "api"
      }
    },
    {
      "id": "service:CloudFront",
      "type": "Service",
      "properties": {
        "name": "CloudFront",
        "type": "cdn"
      }
    },
    {
      "id": "external:Feedly",
      "type": "External",
      "properties": {
        "name": "Feedly",
        "type": "content",
        "description": "RSS feed aggregation"
      }
    },
    {
      "id": "external:YouTube",
      "type": "External",
      "properties": {
        "name": "YouTube",
        "type": "media",
        "description": "Video download source"
      }
    },
    {
      "id": "external:APNS",
      "type": "External",
      "properties": {
        "name": "APNS",
        "type": "notification",
        "description": "Apple Push Notification Service"
      }
    },
    {
      "id": "external:Sign In With Apple",
      "type": "External",
      "properties": {
        "name": "Sign In With Apple",
        "type": "auth",
        "description": "Apple OAuth provider"
      }
    },
    {
      "id": "external:GitHub",
      "type": "External",
      "properties": {
        "name": "GitHub",
        "type": "integration",
        "description": "Issue creation for errors"
      }
    },
    {
      "id": "apimodel:File",
      "type": "ApiModel",
      "properties": {
        "name": "File",
        "modelType": "model",
        "description": "A media file available for download",
        "fields": [
          "fileId",
          "key",
          "size",
          "status",
          "title",
          "publishDate",
          "authorName",
          "authorUser",
          "contentType",
          "description",
          "url"
        ]
      }
    },
    {
      "id": "apimodel:FileListResponse",
      "type": "ApiModel",
      "properties": {
        "name": "FileListResponse",
        "modelType": "model",
        "description": "Response containing a list of files",
        "fields": [
          "contents",
          "keyCount"
        ]
      }
    },
    {
      "id": "apimodel:Device",
      "type": "ApiModel",
      "properties": {
        "name": "Device",
        "modelType": "model",
        "description": "Device information for push notifications",
        "fields": [
          "deviceId",
          "name",
          "systemName",
          "systemVersion",
          "token",
          "endpointArn"
        ]
      }
    },
    {
      "id": "apimodel:DeviceRegistrationRequest",
      "type": "ApiModel",
      "properties": {
        "name": "DeviceRegistrationRequest",
        "modelType": "model",
        "description": "Device registration request",
        "fields": [
          "deviceId",
          "name",
          "systemName",
          "systemVersion",
          "token"
        ]
      }
    },
    {
      "id": "apimodel:DeviceRegistrationResponse",
      "type": "ApiModel",
      "properties": {
        "name": "DeviceRegistrationResponse",
        "modelType": "model",
        "description": "Device registration response",
        "fields": [
          "endpointArn"
        ]
      }
    },
    {
      "id": "apimodel:FeedlyWebhookRequest",
      "type": "ApiModel",
      "properties": {
        "name": "FeedlyWebhookRequest",
        "modelType": "model",
        "description": "Feedly webhook request",
        "fields": [
          "articleFirstImageURL",
          "articleCategories",
          "articlePublishedAt",
          "articleTitle",
          "articleURL",
          "createdAt",
          "sourceFeedURL",
          "sourceTitle",
          "sourceURL",
          "backgroundMode"
        ]
      }
    },
    {
      "id": "apimodel:WebhookResponse",
      "type": "ApiModel",
      "properties": {
        "name": "WebhookResponse",
        "modelType": "model",
        "description": "Webhook processing response",
        "fields": [
          "status"
        ]
      }
    },
    {
      "id": "apimodel:UserLoginRequest",
      "type": "ApiModel",
      "properties": {
        "name": "UserLoginRequest",
        "modelType": "model",
        "description": "User login request",
        "fields": [
          "idToken"
        ]
      }
    },
    {
      "id": "apimodel:UserLoginResponse",
      "type": "ApiModel",
      "properties": {
        "name": "UserLoginResponse",
        "modelType": "model",
        "description": "User login response",
        "fields": [
          "token"
        ]
      }
    },
    {
      "id": "apimodel:UserRegistrationRequest",
      "type": "ApiModel",
      "properties": {
        "name": "UserRegistrationRequest",
        "modelType": "model",
        "description": "User registration request",
        "fields": [
          "idToken",
          "firstName",
          "lastName"
        ]
      }
    },
    {
      "id": "apimodel:UserRegistrationResponse",
      "type": "ApiModel",
      "properties": {
        "name": "UserRegistrationResponse",
        "modelType": "model",
        "description": "User registration response",
        "fields": [
          "token"
        ]
      }
    },
    {
      "id": "apimodel:UserSubscriptionRequest",
      "type": "ApiModel",
      "properties": {
        "name": "UserSubscriptionRequest",
        "modelType": "model",
        "description": "User subscription request",
        "fields": [
          "endpointArn",
          "topicArn"
        ]
      }
    },
    {
      "id": "apimodel:UserSubscriptionResponse",
      "type": "ApiModel",
      "properties": {
        "name": "UserSubscriptionResponse",
        "modelType": "model",
        "description": "User subscription response",
        "fields": [
          "subscriptionArn"
        ]
      }
    },
    {
      "id": "apimodel:TokenRefreshResponse",
      "type": "ApiModel",
      "properties": {
        "name": "TokenRefreshResponse",
        "modelType": "model",
        "description": "Token refresh response",
        "fields": [
          "token",
          "expiresAt",
          "sessionId",
          "userId"
        ]
      }
    },
    {
      "id": "apimodel:ClientEventRequest",
      "type": "ApiModel",
      "properties": {
        "name": "ClientEventRequest",
        "modelType": "model",
        "description": "Client event request for logging",
        "fields": [
          "message"
        ]
      }
    },
    {
      "id": "apimodel:FileStatus",
      "type": "ApiModel",
      "properties": {
        "name": "FileStatus",
        "modelType": "enum",
        "description": "File status enumeration",
        "fields": [
          "Queued",
          "Downloading",
          "Downloaded",
          "Failed"
        ]
      }
    },
    {
      "id": "apiendpoint:listFiles",
      "type": "ApiEndpoint",
      "properties": {
        "name": "listFiles",
        "route": "/files",
        "method": "GET",
        "description": "List available files for authenticated user"
      }
    },
    {
      "id": "apiendpoint:registerDevice",
      "type": "ApiEndpoint",
      "properties": {
        "name": "registerDevice",
        "route": "/device/register",
        "method": "POST",
        "description": "Register device for push notifications"
      }
    },
    {
      "id": "apiendpoint:processFeedlyWebhook",
      "type": "ApiEndpoint",
      "properties": {
        "name": "processFeedlyWebhook",
        "route": "/feedly",
        "method": "POST",
        "description": "Process Feedly webhook"
      }
    },
    {
      "id": "apiendpoint:registerUser",
      "type": "ApiEndpoint",
      "properties": {
        "name": "registerUser",
        "route": "/user/register",
        "method": "POST",
        "description": "Register new user"
      }
    },
    {
      "id": "apiendpoint:loginUser",
      "type": "ApiEndpoint",
      "properties": {
        "name": "loginUser",
        "route": "/user/login",
        "method": "POST",
        "description": "Login existing user"
      }
    }
  ],
  "edges": [
    {
      "source": "apiendpoint:listFiles",
      "target": "lambda:ListFiles",
      "relationship": "implemented_by"
    },
    {
      "source": "apiendpoint:listFiles",
      "target": "apimodel:FileListResponse",
      "relationship": "returns"
    },
    {
      "source": "apiendpoint:registerDevice",
      "target": "lambda:RegisterDevice",
      "relationship": "implemented_by"
    },
    {
      "source": "apiendpoint:registerDevice",
      "target": "apimodel:DeviceRegistrationRequest",
      "relationship": "accepts"
    },
    {
      "source": "apiendpoint:registerDevice",
      "target": "apimodel:DeviceRegistrationResponse",
      "relationship": "returns"
    },
    {
      "source": "apiendpoint:processFeedlyWebhook",
      "target": "lambda:WebhookFeedly",
      "relationship": "implemented_by"
    },
    {
      "source": "apiendpoint:processFeedlyWebhook",
      "target": "apimodel:FeedlyWebhookRequest",
      "relationship": "accepts"
    },
    {
      "source": "apiendpoint:processFeedlyWebhook",
      "target": "apimodel:WebhookResponse",
      "relationship": "returns"
    },
    {
      "source": "apiendpoint:registerUser",
      "target": "lambda:RegisterUser",
      "relationship": "implemented_by"
    },
    {
      "source": "apiendpoint:registerUser",
      "target": "apimodel:UserRegistrationRequest",
      "relationship": "accepts"
    },
    {
      "source": "apiendpoint:registerUser",
      "target": "apimodel:UserRegistrationResponse",
      "relationship": "returns"
    },
    {
      "source": "apiendpoint:loginUser",
      "target": "lambda:LoginUser",
      "relationship": "implemented_by"
    },
    {
      "source": "apiendpoint:loginUser",
      "target": "apimodel:UserLoginRequest",
      "relationship": "accepts"
    },
    {
      "source": "apiendpoint:loginUser",
      "target": "apimodel:UserLoginResponse",
      "relationship": "returns"
    },
    {
      "source": "lambda:LoginUser",
      "target": "apimodel:UserLoginRequest",
      "relationship": "validates_with"
    },
    {
      "source": "lambda:RegisterUser",
      "target": "apimodel:UserRegistrationRequest",
      "relationship": "validates_with"
    },
    {
      "source": "lambda:RegisterDevice",
      "target": "apimodel:DeviceRegistrationRequest",
      "relationship": "validates_with"
    },
    {
      "source": "lambda:UserSubscribe",
      "target": "apimodel:UserSubscriptionRequest",
      "relationship": "validates_with"
    },
    {
      "source": "lambda:WebhookFeedly",
      "target": "apimodel:FeedlyWebhookRequest",
      "relationship": "validates_with"
    },
    {
      "source": "service:API Gateway",
      "target": "lambda:ApiGatewayAuthorizer",
      "relationship": "triggers"
    },
    {
      "source": "service:CloudFront",
      "target": "lambda:CloudfrontMiddleware",
      "relationship": "triggers"
    },
    {
      "source": "service:API Gateway",
      "target": "lambda:ListFiles",
      "relationship": "triggers"
    },
    {
      "source": "service:API Gateway",
      "target": "lambda:LogClientEvent",
      "relationship": "triggers"
    },
    {
      "source": "service:API Gateway",
      "target": "lambda:LoginUser",
      "relationship": "triggers"
    },
    {
      "source": "service:API Gateway",
      "target": "lambda:RefreshToken",
      "relationship": "triggers"
    },
    {
      "source": "service:API Gateway",
      "target": "lambda:RegisterDevice",
      "relationship": "triggers"
    },
    {
      "source": "service:API Gateway",
      "target": "lambda:RegisterUser",
      "relationship": "triggers"
    },
    {
      "source": "service:SQS",
      "target": "lambda:SendPushNotification",
      "relationship": "triggers"
    },
    {
      "source": "service:SQS",
      "target": "lambda:StartFileUpload",
      "relationship": "triggers"
    },
    {
      "source": "service:API Gateway",
      "target": "lambda:UserDelete",
      "relationship": "triggers"
    },
    {
      "source": "service:API Gateway",
      "target": "lambda:UserSubscribe",
      "relationship": "triggers"
    },
    {
      "source": "service:API Gateway",
      "target": "lambda:WebhookFeedly",
      "relationship": "triggers"
    },
    {
      "source": "lambda:S3ObjectCreated",
      "target": "lambda:SendPushNotification",
      "relationship": "invokes",
      "properties": {
        "via": "SQS"
      }
    },
    {
      "source": "entity:Users",
      "target": "entity:UserFiles",
      "relationship": "has_many"
    },
    {
      "source": "entity:Users",
      "target": "entity:UserDevices",
      "relationship": "has_many"
    },
    {
      "source": "entity:Users",
      "target": "entity:Sessions",
      "relationship": "has_many"
    },
    {
      "source": "entity:Users",
      "target": "entity:Accounts",
      "relationship": "has_many"
    },
    {
      "source": "entity:Files",
      "target": "entity:UserFiles",
      "relationship": "has_many"
    },
    {
      "source": "entity:Files",
      "target": "entity:FileDownloads",
      "relationship": "has_many"
    },
    {
      "source": "entity:Devices",
      "target": "entity:UserDevices",
      "relationship": "has_many"
    },
    {
      "source": "entity:UserFiles",
      "target": "entity:Users",
      "relationship": "belongs_to"
    },
    {
      "source": "entity:UserFiles",
      "target": "entity:Files",
      "relationship": "belongs_to"
    },
    {
      "source": "entity:UserDevices",
      "target": "entity:Users",
      "relationship": "belongs_to"
    },
    {
      "source": "entity:UserDevices",
      "target": "entity:Devices",
      "relationship": "belongs_to"
    },
    {
      "source": "entity:Sessions",
      "target": "entity:Users",
      "relationship": "belongs_to"
    },
    {
      "source": "entity:Accounts",
      "target": "entity:Users",
      "relationship": "belongs_to"
    },
    {
      "source": "entity:FileDownloads",
      "target": "entity:Files",
      "relationship": "belongs_to"
    },
    {
      "source": "entity:Users",
      "target": "entity:VerificationTokens",
      "relationship": "has_many"
    },
    {
      "source": "entity:VerificationTokens",
      "target": "entity:Users",
      "relationship": "belongs_to"
    },
    {
      "source": "service:API Gateway",
      "target": "service:Lambda",
      "relationship": "triggers"
    },
    {
      "source": "service:S3",
      "target": "service:Lambda",
      "relationship": "triggers",
      "properties": {
        "event": "s3:ObjectCreated"
      }
    },
    {
      "source": "service:CloudWatch",
      "target": "service:Lambda",
      "relationship": "triggers",
      "properties": {
        "event": "scheduled"
      }
    },
    {
      "source": "service:SQS",
      "target": "service:Lambda",
      "relationship": "triggers"
    },
    {
      "source": "service:EventBridge",
      "target": "service:SQS",
      "relationship": "routes",
      "properties": {
        "event": "DownloadRequested"
      }
    }
  ],
  "metadata": {
    "version": "3.0.0",
    "description": "Media Downloader knowledge graph with Lambda chains, entities, and API contracts (auto-generated)",
    "sources": {
      "lambdas": "src/lambdas/",
      "entities": "src/entities/",
      "typespec": "tsp/",
      "dependencies": "build/graph.json",
      "metadata": "graphrag/metadata.json"
    }
  }
}
