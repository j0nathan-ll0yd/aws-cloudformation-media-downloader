#!/bin/sh
# commit-msg hook: Block AI attribution in commit messages
# This enforces the Zero AI References in Commits convention
#
# To bypass (emergency only): git commit --no-verify

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Check for AI patterns (POSIX-compliant)
check_pattern() {
  pattern=$1
  if echo "$COMMIT_MSG" | grep -iqE "$pattern"; then
    echo ""
    echo "ERROR: Commit message contains AI attribution pattern: '$pattern'"
    echo ""
    echo "This project has a zero-tolerance policy for AI references in commits."
    echo "Please remove AI attribution and write a clean commit message."
    echo ""
    echo "See: docs/wiki/Conventions/Git-Workflow.md"
    echo ""
    echo "To bypass (emergency only): git commit --no-verify"
    exit 1
  fi
}

# Check each pattern
check_pattern "Generated with Claude"
check_pattern "Co-Authored-By: Claude"
check_pattern "Co-Authored-By:.*Anthropic"
check_pattern "AI-generated"
check_pattern "AI generated"
check_pattern "Generated by AI"
check_pattern "Generated by Claude"
check_pattern "Generated by GPT"
check_pattern "Generated by LLM"

# Check robot emoji (encoding-safe)
if echo "$COMMIT_MSG" | grep -q "ðŸ¤–"; then
  echo ""
  echo "ERROR: Commit message contains AI attribution (robot emoji)"
  echo ""
  echo "This project has a zero-tolerance policy for AI references in commits."
  echo "Please remove AI attribution and write a clean commit message."
  echo ""
  echo "See: docs/wiki/Conventions/Git-Workflow.md"
  echo ""
  echo "To bypass (emergency only): git commit --no-verify"
  exit 1
fi

exit 0
